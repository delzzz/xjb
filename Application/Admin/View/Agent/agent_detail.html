<extend name="Public/base"/>

<block name="body">
    <form action="{:U('addAgent')}" method="post" class="form-horizontal form-label-left">
        <div class="right_col" role="main">
            <input type="hidden" id="editFlag" value="{$editFlag|default=0}"/>
            <input type="hidden" name="agentId" value="{$info.agentId}"/>
            <input type="hidden" name="orgId" value="{$info.orgId}"/>
            <input id="current_p" type="hidden" value="{$current_p|default=1}"/>
            <input id="current_p2" type="hidden" value="{$current_p2|default=1}"/>

            <div class="col-md-12 col-xs-12">
                <div class="x_panel">
                    <div class="x_title">
                        <h2>代理商信息</h2>
                        <ul class="nav navbar-right panel_toolbox">
                        </ul>
                        <div class="clearfix"></div>
                    </div>
                    <div class="x_content row">
                        <br/>
                        <div id="f1">
                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                <div class="form-group col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                    <label class="control-label col-md-4 col-sm-4 col-xs-12">代理商名称:</label>
                                    <div class="col-md-8 col-sm-8 col-xs-12">
                                        <input value="{$info['orgOrganization']['orgName']}" name="orgName" type="text" class="form-control" disabled="disabled" placeholder="">
                                    </div>
                                </div>
                                <div class="form-group col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                    <label class="control-label col-md-4 col-sm-4 col-xs-12">代理商等级:</label>
                                    <div class="col-md-8 col-sm-8 col-xs-12">
                                        <select disabled="disabled" class="form-control" name="degree" value="{$info.degree}">
                                            <option value="-1">请选择</option>
                                            <option
                                            <?php if($info['degree'] == 1)echo 'selected';?> value="1">一级代理商</option>
                                            <option
                                            <?php if($info['degree'] == 2)echo 'selected';?> value="2">二级代理商</option>
                                            <option
                                            <?php if($info['degree'] == 3)echo 'selected';?> value="3">三级代理商</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                    <label class="control-label col-md-4 col-sm-4 col-xs-12">代理区域:</label>
                                    <div class="col-md-8 col-sm-8 col-xs-12">
                                        <div id="distpicker2" class="">
                                            <!--省-->
                                            <select disabled="disabled" name="provinceId" class="data-province form-control"></select>
                                            <input type="hidden" id="hid_p" value="{$info.provinceId}"/>
                                            <!--市-->
                                            <select value="129907" disabled="disabled" name="cityId" class="data-city form-control"></select>
                                            <input  type="hidden" id="hid_c" value="{$info.cityId}"/>
                                            <!--县-->
                                            <select value="129908" disabled="disabled" name="countyId" class="data-district form-control"></select>
                                            <input  type="hidden" id="hid_co" value="{$info.countyId}"/>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                    <label class="control-label col-md-4 col-sm-4 col-xs-12">代理商登录ID:</label>
                                    <div class="col-md-8 col-sm-8 col-xs-12">
                                        <input id="logId" type="text" class="form-control" value="A0001(自动生成不可编辑)"
                                               disabled="disabled" placeholder="">
                                    </div>
                                </div>

                                <div class="form-group col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                    <label class="control-label col-md-4 col-sm-4 col-xs-12">公司电话:</label>
                                    <div class="col-md-8 col-sm-8 col-xs-12">
                                        <input name="telephone" value="{$info['orgOrganization']['telephone']}" type="text" class="form-control" disabled="disabled" placeholder="">
                                    </div>
                                </div>
                                <div class="form-group col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                    <label class="control-label col-md-4 col-sm-4 col-xs-12">公司组织机构:</label>
                                    <div class="col-md-8 col-sm-8 col-xs-12">
                                        <input name="orgCode" value="{$info['orgOrganization']['orgCode']}" type="text" class="form-control" disabled="disabled" placeholder="">
                                    </div>
                                </div>

                                <div class="form-group col-lg-8 col-md-8 col-sm-8 col-xs-12">
                                    <label class="control-label col-md-2 col-sm-2 col-xs-12">公司住址:</label>
                                    <div class="col-md-10 col-sm-10 col-xs-12">
                                        <div class="">
                                            <input name="address" value="{$info['orgOrganization']['address']}" type="text" class="form-control" disabled="disabled" placeholder="">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group col-lg-8 col-md-8 col-sm-8 col-xs-12">
                                    <label class="control-label col-md-2 col-sm-2 col-xs-12">
                                        备注:
                                    </label>
                                    <div class="col-md-10 col-sm-10 col-xs-12">
                                        <textarea disabled="disabled" name="remark" class="form-control" rows="3" placeholder='备注在2000字以内'>{$info['orgOrganization']['remark']}</textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <volist name="manageInfo['orgOrganization']['contactList']" id="contact">
                    <div class="x_panel">
                        <div class="x_title">
                            <h2>
                                <if condition="$key eq 0">管理人员
                                    <else/>
                                    负责人
                                </if>
                                基本信息
                            </h2>
                            <ul class="nav navbar-right panel_toolbox">
                            </ul>
                            <div class="clearfix"></div>
                        </div>
                        <div class="x_content row">
                            <br/>
                            <div id="f2">
                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                    <div class="form-group col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                        <label class="control-label col-md-4 col-sm-4 col-xs-12">管理人姓名:</label>
                                        <div class="col-md-8 col-sm-8 col-xs-12">
                                            <input value="{$contact.name}" name="name[]" type="text" class="form-control" disabled="disabled" placeholder="">
                                        </div>
                                    </div>
                                    <div class="form-group col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                        <label class="control-label col-md-4 col-sm-4 col-xs-12">手机号码:</label>
                                        <div class="col-md-8 col-sm-8 col-xs-12">
                                            <input value="{$contact.mobile}" name="mobile[]" type="text" class="form-control" disabled="disabled" placeholder="">
                                        </div>
                                    </div>
                                    <div class="form-group col-lg-8 col-md-8 col-sm-8 col-xs-12">
                                        <label class="control-label col-md-2 col-sm-2 col-xs-12">身份证号:</label>
                                        <div class="col-md-10 col-sm-10 col-xs-12">
                                            <div class="">
                                                <input value="{$contact.idNo}" name="idNo[]" type="text" class="form-control" disabled="disabled" placeholder="">
                                            </div>
                                            <input type="hidden" name="contactId[]" value="{$contact.contactId}">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </volist>
            </div>
            <div class="row">
                <div class="col-md-12 col-sm-12 col-xs-12">
                    <div class="x_panel">
                        <div class="x_title">
                            <h2>公司证件</h2>
                            <ul class="nav navbar-right panel_toolbox">
                            </ul>
                            <div class="clearfix"></div>
                        </div>
                        <div class="x_content">
                            <div action="#" class="dropzone" >
                                <volist name="imgList" id="img">
                                    <div class="dz-preview dz-processing dz-image-preview dz-success dz-complete">
                                        <div class="dz-image">
                                            <img style="width:120px;height:120px;max-width: 100%;" data-dz-thumbnail="" alt="{$img.displayName}"
                                                 src="{$img.imagePath}">
                                        </div>
                                        <a class="dz-remove" data-path="{$img.imagePath}"
                                           data-id="{$img.imageId}" href="javascript:undefined;"
                                           data-dz-remove="">删除</a></div>
                                </volist>
                            </div>
                            <input type="hidden" id="imagePath" value="{$imgPathStr}" name="imagePath">
                            <input type="hidden" value="{$imgIdStr}" name="imgIdStr">
                        </div>
                        <div id="divOption1">
                            <!--变更页面显示-->
                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 " id="btn_edit">
                                <button id="btn_collocate" type="button" class="btn btn-lg btn-danger" data-toggle="modal" data-target="#myModal">账号托管</button>
                                <!--在账号启用状态显示账号停用按钮 在账号停用状态显示启用按钮-->
                                <button type="button" class="btn btn-lg btn-danger">账号停用
                                </button>
                                <button class="btn btn-lg btn-danger ajax-post" type="button" target-form="form-label-left">保存页面</button>
                                <button type="button" class="btn btn-lg btn-danger ">关闭页面</button>
                            </div>
                        </div>
                        <div id="divOption2">
                            <!--详情页面显示-->
                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 " id="btn_detail">
                                <br>
                                <button type="button" class="btn btn-lg btn-danger">关闭页面</button>
                                <!--在账号启用状态显示账号停用按钮 在账号停用状态显示启用按钮-->
                                <button type="button" class="btn btn-lg btn-danger" data-toggle="modal" data-target="#myModal2">代理商信息变更
                                </button>
                                <button type="button" class="btn btn-lg btn-danger ">导出为文档资料</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--设备选择-->
            <div class="x_panel">
                <div id="f4" class="form-group col-md-12 col-sm-12 col-xs-12">
                    <div class="x_title">
                        <h2>设备选择</h2>
                        <ul class="nav navbar-right panel_toolbox">
                        </ul>
                        <div class="clearfix"></div>
                    </div>
                    <div class="col-md-12 col-sm-12 col-xs-12 border-bottom">
                        <br>
                        <div class="checkbox col-md-2 col-sm-2 col-xs-12">
                            <input disabled="disabled" id="device" type="hidden" value="{$manageInfo['orgOrganization']['orgDevice']['deviceType']}"/>
                            <label>
                                <input disabled="disabled" name="deviceType[]" value="0" type="checkbox" class="flat"> 老人终端机
                            </label>
                        </div>
                        <div class="checkbox col-md-2 col-sm-2 col-xs-12">
                            <label>
                                <input disabled="disabled" name="deviceType[]" value="1" type="checkbox" class="flat"> SOS手腕
                            </label>
                        </div>
                        <div class="checkbox col-md-2 col-sm-2 col-xs-12">
                            <label>
                                <input disabled="disabled" name="deviceType[]" value="2" type="checkbox" class="flat"> 门磁状态检测仪
                            </label>
                        </div>
                        <div class="checkbox col-md-2 col-sm-2 col-xs-12">
                            <label>
                                <input disabled="disabled" name="deviceType[]" value="3" type="checkbox" class="flat">
                                烟雾报警器
                            </label>
                        </div>
                        <div class="checkbox col-md-2 col-sm-2 col-xs-12">
                            <label>
                                <input disabled="disabled" name="deviceType[]" value="4" type="checkbox" class="flat">
                                漏水检测器
                            </label>
                        </div>
                        <div class="checkbox col-md-2 col-sm-2 col-xs-12">
                            <label>
                                <input disabled="disabled" name="deviceType[]" value="5" type="checkbox" class="flat">
                                呼吸心率仪
                            </label>
                        </div>
                        <div class="checkbox col-md-2 col-sm-2 col-xs-12">
                            <label>
                                <input disabled="disabled" name="deviceType[]" value="6" type="checkbox" class="flat">
                                人体红外监测
                            </label>
                        </div>
                        <!--<div class="checkbox col-md-12 col-sm-12 col-xs-12">-->
                        <!--<br>-->
                        <!--<label>-->
                        <!--<input type="text" class="flat form-control" placeholder="设备数量">-->
                        <!--</label>-->
                        <!--</div>-->
                    </div>
                </div>
            </div>
            <!--代理权限设置-->
            <div class="x_panel">
                <div id="f5" class="form-group col-md-12 col-sm-12 col-xs-12">
                    <div class="x_title">
                        <h2>代理权限设置</h2>
                        <ul class="nav navbar-right panel_toolbox">
                        </ul>
                        <div class="clearfix"></div>
                    </div>
                    <div class="col-md-12 col-sm-12 col-xs-12 border-bottom">
                        <br>
                        <div class="checkbox col-md-2 col-sm-2 col-xs-12">
                            <label>
                                <input disabled="disabled" checked type="checkbox" class="flat"> 数据统计
                            </label>
                        </div>
                        <div class="checkbox col-md-2 col-sm-2 col-xs-12">
                            <label>
                                <input disabled="disabled" checked type="checkbox" class="flat"> 老人档案
                            </label>
                        </div>
                        <div class="checkbox col-md-2 col-sm-2 col-xs-12">
                            <label>
                                <input disabled="disabled" checked type="checkbox" class="flat"> 设备报警
                            </label>
                        </div>
                        <div class="checkbox col-md-2 col-sm-2 col-xs-12">
                            <label>
                                <input disabled="disabled" checked type="checkbox" class="flat">
                                健康管理
                            </label>
                        </div>
                        <div class="checkbox col-md-2 col-sm-2 col-xs-12">
                            <label>
                                <input disabled="disabled" checked type="checkbox" class="flat">
                                通知管理
                            </label>
                        </div>
                        <div class="checkbox col-md-2 col-sm-2 col-xs-12">
                            <label>
                                <input disabled="disabled" type="checkbox" class="flat">
                                坐席管理
                            </label>
                        </div>
                        <div class="checkbox col-md-2 col-sm-2 col-xs-12">
                            <label>
                                <input disabled="disabled" type="checkbox" class="flat">
                                允许发展下级代理
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="x_panel">
                <div class="page-title" style="">
                    <div class="title_left " style="">
                        <h3>
                            机构信息
                        </h3>
                    </div>
                </div>
                <div class="x_content clear">
                    <div class=""></div>
                    <br>
                    <div class="table-responsive">
                        <table id="table_ins" class="table table-striped jambo_table bulk_action" style="line-height: 54px;">
                            <thead>
                            <tr class="headings">
                                <th class="column-title">日期</th>
                                <th class="column-title">机构名称</th>
                                <th class="column-title">机构性质</th>
                                <th class="column-title">地址</th>
                                <th class="column-title">联系电话</th>
                                <th class="column-title">设备数量</th>
                                <th class="column-title">终端日活</th>
                                <th class="column-title">亲属日活</th>
                                <th class="column-title">操作</th>
                            </tr>
                            </thead>
                            <tbody>
                            <volist name="orgList" id="list">
                                <tr class="even pointer">
                                    <td class="column-title">{:time_format($list['createTime']/1000,'Y-m-d')}</td>
                                    <td class="column-title">{$list.orgName}</td>
                                    <td class="column-title">{$list.insType_text}</td>
                                    <td class="column-title">{$list.district}</td>
                                    <td class="column-title">{$list.telephone}</td>
                                    <td class="column-title">200</td>
                                    <td class="column-title">2000</td>
                                    <td class="column-title">20000</td>
                                    <td class=""><a href="{:U('agent2_detail',['insId'=>$list['institutionId']])}">查看详情</a></td>
                                </tr>
                            </volist>
                            <tr class="page">
                                <td colspan="9">{$_page}</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <!--如果是代理托管则显示其下属代理、机构，如果是机构托管则隐藏下属代理、机构-->
                <div class="x_content clear">
                    <div class="x_title">下属代理公司信息</div>
                    <br>
                    <div class="table-responsive">
                        <table id="table_agent" class="table table-striped jambo_table bulk_action" style="line-height: 54px;">
                            <thead>
                            <tr class="headings">
                                <th class="column-title">日期</th>
                                <th class="column-title">代理等级</th>
                                <th class="column-title">代理区域</th>
                                <th class="column-title">代理公司名称</th>
                                <th class="column-title">联系电话</th>
                                <th class="column-title">设备数量</th>
                                <th class="column-title">终端日活</th>
                                <th class="column-title">亲属日活</th>
                                <th class="column-title">操作</th>
                            </tr>
                            </thead>
                            <tbody>
                            <volist name="agentList" id="agent">
                                <tr class="even pointer <if condition=" $i%2==0">bg-</if>" >
                                    <input type="hidden" value="{$agent.agentId}"/>
                                    <td class="column-title">{$agent.createTime|date='Y-m-d',###}</td>
                                    <td class="column-title">
                                        <if condition="$agent.degree eq 1">
                                            一级(省)
                                            <elseif condition="$agent.degree eq 2"/>
                                            二级（市）
                                            <elseif condition="$agent.degree eq 3"/>
                                            三级(县)
                                            <else/>
                                            官方
                                        </if>
                                    </td>
                                    <td class="column-title">{$agent.area}</td>
                                    <td class="column-title">{$agent.orgName}</td>
                                    <td class="column-title">{$agent.telephone}</td>
                                    <td class="column-title">5000</td>
                                    <td class="column-title">160</td>
                                    <td class="column-title">160</td>
                                    <td class="column-title"><a href="{:U('agent_detail',['agentId'=>$agent['agentId']])}">查看详情</a></td>
                                </tr>
                            </volist>
                            <tr class="page">
                                <td colspan="9">{$_page2}</td>
                            </tr>
                            <input type="hidden" id="totalPage" value="{$totalPage}"/>
                            </tbody>
                        </table>
                    </div>
                </div>
                <!--<a href=""><button class="btn btn-sm btn-danger">重新托管</button></a>-->
                <!--<a href=""><button class="btn btn-sm btn-danger">取消托管</button></a>-->
            </div>
            <div class="x_panel">
                <div class="row tile_count text-center">
                    <div class="col-md-3 col-sm-6 col-xs-6 tile_stats_count">
                        <span class="count_top">直接管理机构</span>
                        <div class="count">2</div>
                        <span class="count_bottom">设备数量：<i class="color-red">300</i></span>
                    </div>
                    <div class="col-md-3 col-sm-6 col-xs-6 tile_stats_count">
                        <span class="count_top">下属二级代理</span>
                        <div class="count">2</div>
                        <span class="count_bottom">设备数量：<i class="color-red">300</i></span>
                    </div>
                    <div class="col-md-3 col-sm-6 col-xs-6 tile_stats_count">
                        <span class="count_top">下属三级代理</span>
                        <div class="count">2</div>
                        <span class="count_bottom">设备数量：<i class="color-red">300</i></span>
                    </div>
                    <div class="col-md-3 col-sm-6 col-xs-6 tile_stats_count">
                        <span class="count_top">总代理机构总数量</span>
                        <div class="count">2</div>
                        <span class="count_bottom">设备数量：<i class="color-red">300</i></span>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </form>
    <form action="{:U('index')}" method="post" class="form-horizontal form-label-deposit" onsubmit="return checkAgent();">
        <input type="hidden" name="agentId" value="{$agentId}"/>
        <!--弹框 托管-->
        <div class="modal fade row" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document" style="width: 70%;">
                <div class="modal-content" style="">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">托管至代理商</h4>
                    </div>
                    <div class="modal-body">
                        <div class="x_content">
                            <div class="table-responsive">
                                <table class="table table-striped jambo_table bulk_action">
                                    <thead>
                                    <tr class="headings">
                                        <th>
                                            操作
                                        </th>
                                        <th class="column-title">代理商等级</th>
                                        <th class="column-title">代理区域</th>
                                        <th class="column-title">代理公司名称</th>
                                        <th class="column-title">代理公司地址</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <volist name="proAgents" id="agents">
                                        <tr class="<if condition='$key %2 ==0'>even<else/>odd</if> pointer">
                                            <td class="a-center ">
                                                <input type="radio" class="flat" name="targetId" value="{$agents.agentId}">
                                            </td>
                                            <td class=" ">
                                                <if condition="$agents.degree eq 1">
                                                    一级(省)
                                                    <elseif condition="$agents.degree eq 2"/>
                                                    二级（市）
                                                    <elseif condition="$agents.degree eq 3"/>
                                                    三级(县)
                                                    <else/>
                                                    官方
                                                </if>
                                                代理
                                            </td>
                                            <td class=" ">{$agents.area}</td>
                                            <td class=" ">{$agents.orgName}</td>
                                            <td class=" ">{$agents.address}</td>
                                        </tr>
                                    </volist>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <input ignore="1" id="collocationId" name="collocationId" type="hidden" value="{$collocationId}" />
                        <button type="submit" class="btn btn-danger" target-form="form-label-deposit">确定</button>
                        <button type="button" class="btn btn-default btn-cancel" data-dismiss="modal">取消</button>
                    </div>
                </div>
            </div>
        </div>
    </form>
    <!--弹框 代理商信息变更-->
    <div class="modal fade row" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document" style="">
            <div class="modal-content" style="">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel2">安全验证</h4>
                </div>
                <div class="modal-body">
                    <h4 class="modal-title text-center" id="">为了保护公司信息安全，需要通过本公司负责人手机验证码</h4><br>
                    <div class="input-group col-lg-12 col-md-12 col-sm-12">
                        <input type="text" class="form-control">
                        <span class="input-group-btn">
                           <button type="button" class="btn btn-danger">发送验证码</button>
                        </span>
                    </div>
                    <div class="input-group col-lg-12 col-md-12 col-sm-12">
                        <input type="text" class="form-control" placeholder="输入验证码">

                    </div>
                    <div class="input-group col-lg-12 col-md-12 col-sm-12">
                        <input type="text" class="form-control" placeholder="情况说明：例如二级代理商信息变更">
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="btnDailiShang" type="button" class="btn btn-danger col-lg-12 col-md-12 col-sm-12">确定</button>
                </div>
            </div>
        </div>
    </div>
</block>
<block name="script">
    <script>
        $('.btn-cancel').click(function(){
            if($('#collocationId').val() !== ''){
                history.go(-1);
            }
        });
        if($('#collocationId').val() !== ''){
            $('#btn_collocate').click();
        }
        function checkAgent(){
            if(!$('input[name="targetId"]:checked').val()){
                alert('请选择要托管的代理商!');
                return false;
            }
            return true;
        }
        //编辑页
        $('#divOption1').hide();
        $("#btnDailiShang").click(function () {
            $('#f1 input:not(#logId),#f2 input,#f3 input,textarea,select').attr('disabled', false);
           // $('.dropzone').removeAttr('disabled');
            $('#divOption1').show();
            $('#divOption2').hide();
        });

        //返回匹配替换的字符串
        function replace_str(str, newstr) {
            var reg = /p2\/(.*?)\//;
            var reg2 = /p2\/(.*?)\./;
            if (reg.test(agent_href)) {
                return str.replace(reg, newstr);
                //var test1 =str.match(reg);
                //return test1[1];
            }
            else if (reg2.test(agent_href)) {
                //var test2 =str.match(reg2);
                //return test2[1];
                return str.replace(reg2, newstr + '.');
            }
            else {
                return false;
            }
        }
        var current_p = $('#current_p').val();
        var current_p2 = $('#current_p2').val();
        //console.log(current_p);
        // console.log(current_p2);
        if (current_p2 != 1) {
            var agent_href = $('#table_agent .page a').attr('href');
            //替换span current p2 url
            current_href = replace_str(agent_href, 'p2/' + current_p);
            $('#table_agent .page .current').replaceWith('<a class="num" href="' + current_href + '">' + current_p + '</a>');
            if (current_p == 1) {
                //更改current
                $('#table_agent .page a').eq(current_p2 - 1).replaceWith('<span class="current">' + current_p2 + '</span>');
                var prev_href = replace_str(agent_href, 'p2/' + (current_p2 - 1));
                //添加agent的prev
                $('#table_agent .page .num').parent('div').prepend('<a class="prev" href="' + prev_href + '"><<</a>');
                //更改next
                if ($('#totalPage').val() == current_p2) {
                    $('#table_agent .page .next').hide();
                }
                else {
                    var next_href = replace_str(agent_href, 'p2/' + (parseInt(current_p2) + 1));
                    $('#table_agent .page .next').attr('href', next_href);
                }
            }
            else {
                //更改current
                $('#table_agent .page a').eq(current_p2).replaceWith('<span class="current">' + current_p2 + '</span>');
                //更改agent的prev
                var prev_href = replace_str(agent_href, 'p2/' + (current_p2 - 1)+'/');
                $('#table_agent .page .prev').attr('href', prev_href);
                //最后页隐藏next
                if ($('#totalPage').val() == current_p2) {
                    $('#table_agent .page .next').hide();
                }
                else {
                    //更改agent的next
                    var next_href = replace_str(agent_href, 'p2/' + (parseInt(current_p2) + 1)+'/');
                    $('#table_agent .page .next').attr('href', next_href);
                }

            }
        }
        else {
            //替换span current p2 url
            var agent_href = $('#table_agent .page a').attr('href');
            var cp2 = $('#table_agent .page .current').text();
            agent_href = replace_str(agent_href, 'p2/' + cp2);
            $('#table_agent .page .current').replaceWith('<a class="num" href="' + agent_href + '">' + cp2 + '</a>');
            //更改current
            $('#table_agent .page .num').eq(0).replaceWith('<span class="current">1</span>');
            //隐藏agent prev
            $('#table_agent .page .prev').hide();
            //更改Next
            var next_href = replace_str(agent_href, 'p2/2');
            $('#table_agent .page .next').attr('href', next_href);
        }

        //设备多选选中
        var device = $('#device').val();
        var device_arr = device.split(',');
        $.each(device_arr, function (i, item) {
            $('input[name="deviceType[]"]').each(function (j, devices) {
                if ($(this).val() == item) {
                    $(this).attr('checked', true);
                }
            })
        });

        //图片
        $(".dz-remove").click(function () {
            var pathStr = $("#imagePath").val();
            var imgId = $(this).attr("data-id");
            var imgPath = $(this).attr("data-path");
            pathStr = pathStr.replace(imgPath + ',', '');
            pathStr = pathStr.replace(imgPath, '');
//            pathStr = pathStr.substr(0, pathStr.length - 1);
            var firstChat = pathStr.substr(0, 1);
            var lastChat = pathStr.substr(pathStr.length - 1, pathStr.length);
            if (lastChat == ',') {
                pathStr = pathStr.substr(0, pathStr.length - 1);
            }
            $("#imagePath").val(pathStr);
            $.ajax({
                url: "{:U('file/delPic')}" + "?imageId=" + imgId,
                type: 'GET',
                success: function (data) {
                }
            })
            $(this).parent().remove();
        });
        $(function () {
            Page.hid_p = $('#hid_p').val();
            Page.hid_c = $('#hid_c').val();
            Page.hid_co = $('#hid_co').val();
            Page.init();
        });

        var d = $('select[name="degree"]').val();
        hide_area(d);
        $('select[name="degree"]').change(function () {
            var degree = $(this).val();
            hide_area(degree);
        });


    </script>
</block>